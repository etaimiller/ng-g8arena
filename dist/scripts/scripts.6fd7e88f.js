"use strict";angular.module("ngG8arenaApp",["ngAnimate","ngResource","ngRoute","ngSanitize","ngTouch","ipCookie","ui.router","ng-token-auth","formly","formlyBootstrap"]).constant("g8arenaConfig",{apiUrl:"http://g8arena.herokuapp.com"}).config(["$stateProvider","$urlRouterProvider","$authProvider","g8arenaConfig","formlyConfigProvider",function(a,b,c,d,e){a.state("home",{url:"/home",templateUrl:"scripts/home/_home.html",controller:"HomeCtrl",requireAuth:!1}).state("login",{url:"/login",templateUrl:"scripts/auth/_login.html",controller:"AuthCtrl",requireAuth:!1}).state("register",{url:"/register",templateUrl:"scripts/auth/_register.html",controller:"AuthCtrl",requireAuth:!1}).state("profile",{url:"/profile","abstract":!0,template:"<ui-view/>"}).state("profile.show",{url:"/show",templateUrl:"scripts/profile/_profile.show.html",controller:"ProfileCtrl",requireAuth:!0}).state("match",{url:"/match","abstract":!0,template:"<ui-view/>"}).state("match.new",{url:"/new",templateUrl:"scripts/match/_match.new.html",controller:"MatchCtrl",requireAuth:!0,resolve:{teamsWithUserPromise:["Team",function(a){return a.getAllTeams()}]}}).state("match.index",{url:"/index",templateUrl:"scripts/match/_match.index.html",controller:"MatchCtrl",requireAuth:!0,resolve:{allMatchesPromise:["Match",function(a){return a.getAllMatches()}]}}).state("teams",{url:"/teams","abstract":!0,template:"<ui-view/>"}).state("teams.index",{url:"/index",templateUrl:"scripts/teams/_teams.index.html",controller:"TeamCtrl",requireAuth:!0,resolve:{teamsWithUserPromise:["Team",function(a){return a.getAllUsers().then(function(){a.getAllTeams()})}]}}),b.otherwise("home"),c.configure({apiUrl:d.apiUrl})}]).run(["$rootScope","$state","$auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d,e,f,g){console.log("before if"),d.requireAuth&&"undefined"==typeof c.user.signedIn&&(console.log("after if"),c.validateUser().then(function(){console.log("User validated:"),console.log(c.user)},function(){console.log("Could not validate user:"),console.log(c.user),a.preventDefault(),b.go("login")}))})}]),angular.module("ngG8arenaApp").controller("HomeCtrl",["$scope",function(a){a.message="Welcome to the home controller"}]),angular.module("ngG8arenaApp").controller("AuthCtrl",["$scope","$auth","$state",function(a,b,c){a.message="Welcome to the home controller",a.login=function(){b.submitLogin(a.user).then(function(){c.go("match.index")})["catch"](function(a){console.log(a)})},a.register=function(){console.log("user details:"),console.log(a.user),b.submitRegistration(a.user).then(function(){c.go("team.index")})["catch"](function(a){console.log(a)})}}]),angular.module("ngG8arenaApp").controller("ProfileCtrl",["$scope",function(a){a.message="Welcome to the home controller"}]),angular.module("ngG8arenaApp").controller("NavCtrl",["$scope","$auth","$state",function(a,b,c){a.logout=function(){console.log("logging out"),b.signOut().then(function(){c.go("home")})},a.$on("auth:registration-email-success",function(b,c){a.user=c,console.log("Registration successful"),console.log(c)}),a.$on("auth:login-success",function(c,d){a.user=d,console.log(b.user),console.log("Successful Login")}),a.$on("auth:logout-error",function(a){console.log("logout error because:",a.errors[0])}),a.$on("auth:logout-success",function(){a.user={},console.log("Successfull Logout"),c.go("home")})}]),angular.module("ngG8arenaApp").controller("MatchCtrl",["$scope","$state","Team","Characters","Match",function(a,b,c,d,e){function f(){console.log("Submitting match"),e.create({match:{result:angular.toJson(a.model)}}).then(function(){a.options.resetModel(),b.go("match.index")})}function g(){for(var a=[],b=0;b<d.allOptions.length;b++){var c=d.allOptions[b].name;a.push({name:c,value:d.formatToEnum(c)})}return a}function h(){for(var b=[],c=0;c<a.teams.length;c++)a.teams[c].users.length>1?b.push({name:a.teams[c].users[0].first_name+" & "+a.teams[c].users[1].first_name,value:a.teams[c]}):b.push({name:a.teams[c].users[0].first_name,value:a.teams[c]});return b}a.teams=c.teams,a.allMatches=e.allMatches,a.readableMatches=e.readableMatches,a.onSubmit=f,a.model={},a.fields=[{type:"select",key:"winning_team",templateOptions:{label:"Winning Team: Select user(s)",options:h(),required:!0}},{type:"select",key:"winning_team_c1",templateOptions:{label:"User",options:g(),required:!0},hideExpression:"!model.winning_team",expressionProperties:{"templateOptions.label":function(a,b,c){return c.model.winning_team?1===c.model.winning_team.users.length?c.model.winning_team.users[0].first_name+"'s 1st character:":c.model.winning_team.users[0].first_name+"'s character":void 0}}},{type:"select",key:"winning_team_c2",templateOptions:{label:"User",options:g(),required:!0},hideExpression:"!model.winning_team",expressionProperties:{"templateOptions.label":function(a,b,c){return c.model.winning_team?1===c.model.winning_team.users.length?c.model.winning_team.users[0].first_name+"'s 2nd character:":c.model.winning_team.users[1].first_name+"'s character":void 0}}},{template:"<div style='text-align:center'><h4>VS</h4></div>"},{type:"select",key:"losing_team",templateOptions:{label:"Losing Team: Select user(s)",options:h(),required:!0}},{type:"select",key:"losing_team_c1",templateOptions:{label:"User",options:g(),required:!0},hideExpression:"!model.losing_team",expressionProperties:{"templateOptions.label":function(a,b,c){return c.model.losing_team?1===c.model.losing_team.users.length?c.model.losing_team.users[0].first_name+"'s 1st character:":c.model.losing_team.users[0].first_name+"'s character":void 0}}},{type:"select",key:"losing_team_c2",templateOptions:{label:"User",options:g(),required:!0},hideExpression:"!model.losing_team",expressionProperties:{"templateOptions.label":function(a,b,c){return c.model.losing_team?1===c.model.losing_team.users.length?c.model.losing_team.users[0].first_name+"'s 2nd character:":c.model.losing_team.users[1].first_name+"'s character":void 0}}},{type:"radio",key:"rounds",templateOptions:{label:"Number of rounds:",options:[{name:"2",value:2},{name:"3",value:3}],required:!0},hideExpression:"!model.losing_team_c1 || !model.losing_team_c2 || !model.winning_team_c1 || !model.losing_team_c2"}]}]),angular.module("ngG8arenaApp").factory("Team",["$http","g8arenaConfig",function(a,b){var c={teams:[],team:{},allUsers:[]};return c.create=function(d){return a.post(b.apiUrl+"/teams",d).success(function(a){c.teams.push(a.data)}).error(function(a){console.log(a.errors)})},c.getAllTeams=function(){return a.get(b.apiUrl+"/teams").success(function(a){angular.copy(a.data,c.teams)})},c.getAllUsers=function(){return a.get(b.apiUrl+"/teams/available_users").success(function(a){angular.copy(a.data,c.allUsers)})},c}]),angular.module("ngG8arenaApp").controller("TeamCtrl",["$scope","$state","Team",function(a,b,c){function d(){var b=[];a.model.user1&&(b.push(a.model.user1),a.model.user2&&b.push(a.model.user2)),c.create({team:{users:angular.toJson(b)}})}function e(){for(var b=[],c=0;c<a.users.length;c++)b.push({name:a.users[c].first_name,value:a.users[c]});return b}a.teams=c.teams,a.users=c.allUsers,a.onSubmit=d,a.model={},a.fields=[{type:"select",key:"user1",templateOptions:{label:"Player 1",options:e()}},{type:"checkbox",key:"two_players",templateOptions:{label:"Another team member?"}},{type:"select",key:"user2",templateOptions:{label:"Player 2",options:e()},hideExpression:"!model.two_players"}]}]),angular.module("ngG8arenaApp").factory("Characters",function(){var a={allOptions:[{name:"Baraka"},{name:"Cyber Sub-Zero"},{name:"Ermac"},{name:"Jade"},{name:"Johnny Cage"},{name:"Jax"},{name:"Kabal"},{name:"Kano"},{name:"Kitana"},{name:"Kung Lao"},{name:"Liu kang"},{name:"Mileena"},{name:"Nightwolf"},{name:"Noob"},{name:"Quan Chi"},{name:"Raiden"},{name:"Reptile"},{name:"Scorpion"},{name:"Sektor"},{name:"Shang Tsung"},{name:"Sheeva"},{name:"Sindel"},{name:"Smoke"},{name:"Sonya Blade"},{name:"Stryker"},{name:"Sub-Zero"}]};return a.formatToEnum=function(a){return a.toLowerCase().split(" ").join("_")},a}),angular.module("ngG8arenaApp").factory("Match",["$http","g8arenaConfig",function(a,b){function c(){for(var a=[],b=0;b<f.allMatches.length;b++){var c=angular.fromJson(f.allMatches[b].result);a.push({winning_team:d(c),losing_team:e(c),rounds:c.rounds,created_at:f.allMatches[b].created_at})}return a}function d(a){var b=[];return b=a.winning_team.users.length>1?[{name:a.winning_team.users[0].first_name,character:a.winning_team_c1},{name:a.winning_team.users[1].first_name,character:a.winning_team_c2}]:[{name:a.winning_team.users[0].first_name,characters:[a.winning_team_c1,a.winning_team_c2]}]}function e(a){var b=[];return b=a.losing_team.users.length>1?[{name:a.losing_team.users[0].first_name,character:a.losing_team_c1},{name:a.losing_team.users[1].first_name,character:a.losing_team_c2}]:[{name:a.losing_team.users[0].first_name,characters:[a.losing_team_c1,a.losing_team_c2]}]}var f={allMatches:[],match:{},readableMatches:[]};return f.create=function(c){return a.post(b.apiUrl+"/matches",c).success(function(a){}).error(function(a){console.log(a.errors)})},f.getAllMatches=function(){return a.get(b.apiUrl+"/matches").success(function(a){angular.copy(a.data,f.allMatches),console.log(f.allMatches[0]),f.readableMatches=c()})},f.getUserMatches=function(){},f}]);